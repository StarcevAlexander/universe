name: Simple Deploy

on:
  push:
    branches: [ main ]
  workflow_dispatch: # ← Добавьте эту строку для ручного запуска
    inputs:
      environment:
        description: 'Environment to deploy to'
        required: true
        default: 'production'
        type: choice
        options:
          - production
          - staging

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: List all files
        run: find . -type f | head -20

      - name: Simple file copy test
        run: |
          # Создаем тестовый файл
          echo "TEST FILE" > test.txt
          echo "<html><body><h1>Works!</h1></body></html>" > index.html
          
          # Настраиваем SSH
          mkdir -p ~/.ssh
          echo "${{ secrets.VM_SSH_KEY }}" > ~/.ssh/vm_key
          chmod 600 ~/.ssh/vm_key
          ssh-keyscan -H ${{ secrets.VM_HOST }} >> ~/.ssh/known_hosts
          
          # Копируем тестовые файлы
          scp -i ~/.ssh/vm_key test.txt index.html ${{ secrets.VM_USERNAME }}@${{ secrets.VM_HOST }}:/var/www/your-app/
          
          echo "Basic file copy worked!"